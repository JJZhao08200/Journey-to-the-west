<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube æ•°æ®åˆ†æ Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <!-- å¼•å…¥ PapaParse ç”¨äºè§£æ CSV -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    /* CSV è¡¨æ ¼æ ·å¼ */
    #csvTable {
      display: none;
      border-collapse: collapse;
      width: 80%;
      margin: 20px auto;
    }
    #csvTable th, #csvTable td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    #toggleCsvBtn {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ“Š YouTube æ•°æ®åˆ†æ Dashboard</h1>
    <nav>
      <a href="index.html">ğŸ  é¦–é¡µ</a>
      <a href="team.html">ğŸ‘¥ å›¢é˜Ÿä»‹ç»</a>
    </nav>
  </header>

  <main>
    <!-- Looker Studio æŠ¥å‘Š -->
    <iframe width="50%" height="900" src="https://lookerstudio.google.com/embed/reporting/7b5b480f-a0e3-45f5-94e7-1dec99d1e329/page/JgD" frameborder="0" style="border:0" allowfullscreen sandbox="allow-storage-access-by-user-activation allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox"></iframe>

    <!-- ChatGPT API äº¤äº’ -->
    <div class="chat-container">
      <h2>ğŸ¤– Chat with GPT</h2>
      <textarea id="user-input" placeholder="è¾“å…¥ä½ çš„é—®é¢˜..."></textarea>
      <button onclick="sendMessage()">å‘é€</button>
      <div id="chat-output"></div>
    </div>

    <!-- YouTube æ•°æ®è·å– -->
    <div class="fetch-data-container">
      <h2>ğŸ“Š è·å– YouTube çƒ­é—¨æ•°æ®</h2>
      <button onclick="fetchYoutubeData()">è·å–æ•°æ®</button>
      <pre id="data-output"></pre>
    </div>

    <!-- CSV è¡¨æ ¼åŒºåŸŸï¼ˆåˆå§‹éšè—ï¼‰ -->
    <div class="csv-container">
      <h2>ğŸ“‘ CSV æ•°æ®å±•ç¤º</h2>
      <button id="toggleCsvBtn">æ˜¾ç¤º CSV è¡¨æ ¼</button>
      <table id="csvTable">
        <!-- è¡¨å¤´å’Œå†…å®¹å°†åœ¨ JavaScript ä¸­ç”Ÿæˆ -->
      </table>
    </div>
  </main>

  <footer>
    <p>ğŸ“… æ¯å°æ—¶æ›´æ–°æ•°æ® | ç”±å›¢é˜Ÿç»´æŠ¤</p>
  </footer>

  <!-- ChatGPT API äº¤äº’è„šæœ¬ -->
  <script>
    const API_KEY = "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";  // æ›¿æ¢ä¸ºä½ çš„ OpenAI API Key

    async function sendMessage() {
      const userInput = document.getElementById("user-input").value;
      if (!userInput) return;

      document.getElementById("chat-output").innerHTML = "â³ æ­£åœ¨ç”Ÿæˆå›å¤...";
      
      const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${API_KEY}`
          },
          body: JSON.stringify({
              model: "gpt-4",
              messages: [{ role: "user", content: userInput }]
          })
      });

      const data = await response.json();
      document.getElementById("chat-output").innerHTML = `<strong>ChatGPT:</strong> ${data.choices[0].message.content}`;
    }
  </script>

  <!-- YouTube æ•°æ®è·å–è„šæœ¬ -->
  <script>
    async function fetchYoutubeData() {
      const API_URL = "https://9be3-34-55-7-219.ngrok-free.app/fetch_youtube_data";  // æ›¿æ¢ä¸ºä½ çš„ ngrok URL
      try {
        document.getElementById("data-output").textContent = "â³ æ­£åœ¨è·å–æ•°æ®...";
        
        let response = await fetch(API_URL);
        let data = await response.json();

        console.log("âœ… æ•°æ®è·å–æˆåŠŸ:", data);
        document.getElementById("data-output").textContent = JSON.stringify(data, null, 2);
      } catch (error) {
        console.error("âŒ è·å–æ•°æ®å¤±è´¥:", error);
        document.getElementById("data-output").textContent = "âŒ è·å–æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥ API è¿æ¥";
      }
    }
  </script>

  <!-- CSV è¡¨æ ¼åŠ è½½å’Œæ˜¾ç¤ºè„šæœ¬ -->
  <script>
    // å½“é¡µé¢åŠ è½½æ—¶ï¼Œé€šè¿‡ PapaParse åŠ è½½ CSV æ–‡ä»¶
    document.addEventListener("DOMContentLoaded", function() {
      // ä½¿ç”¨ fetch åŠ è½½ CSV æ–‡ä»¶ï¼Œç¡®ä¿ data.csv åœ¨åŒä¸€ç›®å½•ä¸‹
      fetch("data.csv")
        .then(response => response.text())
        .then(csvText => {
          const parsed = Papa.parse(csvText, { header: true });
          const table = document.getElementById("csvTable");

          // ç”Ÿæˆè¡¨å¤´
          if (parsed.meta.fields) {
            const thead = document.createElement("thead");
            const headerRow = document.createElement("tr");
            parsed.meta.fields.forEach(field => {
              const th = document.createElement("th");
              th.textContent = field;
              headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);
          }

          // ç”Ÿæˆè¡¨ä½“
          const tbody = document.createElement("tbody");
          parsed.data.forEach(row => {
            const tr = document.createElement("tr");
            parsed.meta.fields.forEach(field => {
              const td = document.createElement("td");
              td.textContent = row[field] || "";
              tr.appendChild(td);
            });
            tbody.appendChild(tr);
          });
          table.appendChild(tbody);
        })
        .catch(error => {
          console.error("CSV åŠ è½½å¤±è´¥ï¼š", error);
        });
    });

    // æ§åˆ¶ CSV è¡¨æ ¼æ˜¾ç¤º/éšè—çš„æŒ‰é’®
    const toggleCsvBtn = document.getElementById("toggleCsvBtn");
    const csvTable = document.getElementById("csvTable");

    toggleCsvBtn.addEventListener("click", function() {
      if (csvTable.style.display === "none" || csvTable.style.display === "") {
        csvTable.style.display = "table";
        toggleCsvBtn.textContent = "éšè— CSV è¡¨æ ¼";
      } else {
        csvTable.style.display = "none";
        toggleCsvBtn.textContent = "æ˜¾ç¤º CSV è¡¨æ ¼";
      }
    });
  </script>
</body>
</html>
